<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <canvas id="myCanvas" width="500" height="500"></canvas>
    <script type="text/javascript">
        const canvas = document.getElementById("myCanvas");
        const ctx = canvas.getContext("2d");

        var super_X = 100;
        var super_y = 100;
        var direccion = '';

        class Rectangulo {
            constructor(color, w, h, x, y) {
                this.color = color;
                this.w = w;
                this.h = h;
                this.x = x;
                this.y = y;
            }
        }

        function movimientoX() {
            var numero = Math.floor(Math.random() * 500) + 1;
            return numero;
        }

        function movimientoY() {
            var numero2 = Math.floor(Math.random() * 500) + 1;
            return numero2;
        }

        var player = new Rectangulo("red", 50, 50, 120, 120);
        var colision = new Rectangulo("black", 10, 10, 20, 20);
        var obstaculo = new Rectangulo("grey", 200, 50, 150, 420);

        document.addEventListener("keydown", event => {
            if (event.key.startsWith("Arrow")) {
                event.preventDefault();

                switch (event.key) {
                    case "ArrowUp":
                        direccion = 'up';
                        break;
                    case "ArrowDown":
                        direccion = 'down';
                        break;
                    case "ArrowLeft":
                        direccion = 'left';
                        break;
                    case "ArrowRight":
                        direccion = 'right';
                        break;
                }
            }
        });

        function chocar() {
            var n = movimientoX();
            var x = movimientoY();
            if (player.x < colision.x + 10 && player.x + 50 > colision.x && player.y < colision.y + 10 && player.y + 50 > colision.y) {
                colision.x = n;
                colision.y = x;
            }
        }

        function detectarColisionConObstaculo() {
            if (player.x < obstaculo.x + obstaculo.w &&
                player.x + player.w > obstaculo.x &&
                player.y < obstaculo.y + obstaculo.h &&
                player.y + player.h > obstaculo.y) {
                return true;
            }
            return false;
        }

        function movimiento() {
            let posicionAnterior = { x: player.x, y: player.y };

            switch (direccion) {
                case 'up':
                    player.y -= 8;
                    break;
                case 'down':
                    player.y += 8;
                    break;
                case 'right':
                    player.x += 8;
                    break;
                case 'left':
                    player.x -= 8;
                    break;
            }

            if (detectarColisionConObstaculo()) {
                player.x = posicionAnterior.x;
                player.y = posicionAnterior.y;
            }

            if (player.x > canvas.width) {
                player.x = 0;
            } else if (player.x < 0) {
                player.x = canvas.width - 30;
            }

            if (player.y > canvas.height) {
                player.y = 0;
            } else if (player.y < 0) {
                player.y = canvas.height - 30;
            }

            if (colision.x > canvas.width) {
                colision.x = 0;
            } else if (colision.x < 0) {
                colision.x = canvas.width - 30;
            }

            if (colision.y > canvas.height) {
                colision.y = 0;
            } else if (colision.y < 0) {
                colision.y = canvas.height - 30;
            }
        }

        function pintar() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.w, player.h);

            ctx.fillStyle = colision.color;
            ctx.fillRect(colision.x, colision.y, colision.w, colision.h);

            ctx.fillStyle = obstaculo.color;
            ctx.fillRect(obstaculo.x, obstaculo.y, obstaculo.w, obstaculo.h);

            chocar();
            movimiento();
            requestAnimationFrame(pintar);
        }

        requestAnimationFrame(pintar);
    </script>
</body>

</html>
